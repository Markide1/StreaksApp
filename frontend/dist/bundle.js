(()=>{"use strict";var e={972:(e,t,n)=>{n.d(t,{A:()=>o});const o=n.p+"images/default-avatar.png"}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,n),a.exports}n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var o=t.getElementsByTagName("script");if(o.length)for(var r=o.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=o[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),n.d({},{o:()=>m});var o=function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{d(o.next(e))}catch(e){a(e)}}function s(e){try{d(o.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}d((o=o.apply(e,t||[])).next())}))};const r="http://localhost:3000";function a(e){return e instanceof Error?(console.error("Error:",e.message),e.message):"string"==typeof e?(console.error("Error:",e),e):(console.error("Unknown error:",e),"An unknown error occurred")}var i=function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{d(o.next(e))}catch(e){a(e)}}function s(e){try{d(o.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}d((o=o.apply(e,t||[])).next())}))};let s=[],d=0,c=0;const l=function(e){let t=null;return(...n)=>new Promise((o=>{t&&clearTimeout(t),t=setTimeout((()=>{o(e(...n))}),300)}))}((e=>i(void 0,void 0,void 0,(function*(){if(e)try{console.log("Rendering streaks..."),s=yield function(){return o(this,void 0,void 0,(function*(){try{const e=localStorage.getItem("token");if(!e)throw new Error("No token found");console.log("Token being sent:",e);const t=yield fetch(`${r}/api/streaks`,{headers:{Authorization:`Bearer ${e}`}});if(!t.ok){const e=yield t.text();throw new Error(`HTTP error! status: ${t.status}, message: ${e}`)}return yield t.json()}catch(e){throw console.error("Get streaks error:",e),e}}))}(),console.log("Streaks data received:",s),function(){d=Math.max(...s.map((e=>e.count))),c=s.reduce(((e,t)=>e+t.count),0);const e=document.getElementById("longest-streak"),t=document.getElementById("current-streak");e&&(e.textContent=`Longest Streak: ${d} days`),t&&(t.textContent=`Current Streak: ${c} days`)}(),function(){const e=document.getElementById("streaks-list");e&&Array.isArray(s)?(e.innerHTML="",s.forEach((t=>{if(t&&t.name&&void 0!==t.count&&void 0!==t.lastReset){const n=document.createElement("div");n.innerHTML=`\n                    <h3>${t.name}</h3>\n                    <p>Current streak: ${t.count} days</p>\n                    <p>Last reset: ${new Date(t.lastReset).toLocaleDateString()}</p>\n                    <button class="update-streak" data-id="${t.id}">Update</button>\n                    <button class="reset-streak" data-id="${t.id}">Reset</button>\n                    <button class="delete-streak" data-id="${t.id}">Delete</button>\n                `,e.appendChild(n)}else console.error("Invalid streak format:",t)}))):console.error("Invalid streaks data format")}()}catch(t){console.error("Render streak error:",t),e.innerHTML=`<p>Failed to load streak data. Error: ${t instanceof Error?t.message:"Unknown error"}</p>`}else console.error("Streak container not found")}))));var u=function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{d(o.next(e))}catch(e){a(e)}}function s(e){try{d(o.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}d((o=o.apply(e,t||[])).next())}))};const p={home:function(e){var t,n;e.innerHTML='\n        <div class="home-container">\n            <h1>Welcome to StreaksApp</h1>\n            <h3>Track your daily habits and build streaks to stay motivated!</h3>\n            <p>StreaksApp helps you achieve your goals by making it easy to track your progress and stay accountable. Whether you want to exercise more, eat healthier, or learn a new skill, StreaksApp can help you stay on track.</p>\n            <p>Please login or sign up to continue.</p>\n            <button id="login-btn">Login</button>\n            <button id="signup-btn">Sign Up</button>\n        </div>\n    ',null===(t=document.getElementById("login-btn"))||void 0===t||t.addEventListener("click",(()=>m("login"))),null===(n=document.getElementById("signup-btn"))||void 0===n||n.addEventListener("click",(()=>m("signup")))},login:function(e){if(!e)return;e.innerHTML='\n        <h2>Login</h2>\n        <form id="login-form">\n            <input type="email" id="email" placeholder="Email" required>\n            <input type="password" id="password" placeholder="Password" required>\n            <button type="submit">Login</button>\n            <button id="back-btn">Back</button>\n        </form>\n        <p>Don\'t have an account? <a href="#" id="signup-link">Sign up</a></p>\n        <p>Forgot your password? <a href="#" id="reset-password-link">Reset password</a></p>\n    ';const t=document.getElementById("login-form"),n=document.getElementById("signup-link"),i=document.getElementById("reset-password-link"),s=document.getElementById("back-btn");t.addEventListener("submit",(e=>{return t=this,n=void 0,s=function*(){e.preventDefault();const t=document.getElementById("email").value,n=document.getElementById("password").value;try{yield function(e,t){return o(this,void 0,void 0,(function*(){const n=yield fetch(`${r}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!n.ok){const e=yield n.json();throw new Error(`Failed to login: ${e.error||n.statusText}`)}const o=yield n.json();if(!o.token)throw new Error("No token received");localStorage.setItem("token",o.token),localStorage.setItem("username",o.username)}))}(t,n),m("dashboard")}catch(e){const t=a(e);alert(`Login failed: ${t}`)}},new((i=void 0)||(i=Promise))((function(e,o){function r(e){try{d(s.next(e))}catch(e){o(e)}}function a(e){try{d(s.throw(e))}catch(e){o(e)}}function d(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,a)}d((s=s.apply(t,n||[])).next())}));var t,n,i,s})),n.addEventListener("click",(e=>{e.preventDefault(),m("signup")})),i.addEventListener("click",(e=>{e.preventDefault(),m("passwordReset")})),s.addEventListener("click",(()=>{m("home")}))},dashboard:function(e){return u(this,void 0,void 0,(function*(){if(!e)return void console.error("Dashboard container not found");console.log("Rendering dashboard...");const t=localStorage.getItem("username")||"User";try{const{longestStreak:s,currentStreak:d}=yield function(){return o(this,void 0,void 0,(function*(){try{const e=localStorage.getItem("token");if(!e)throw new Error("No token found");const t=yield fetch(`${r}/api/streaks/stats`,{headers:{Authorization:`Bearer ${e}`}});if(!t.ok){const e=yield t.text();throw new Error(`HTTP error! status: ${t.status}, message: ${e}`)}return yield t.json()}catch(e){throw console.error("Get streak stats error:",e),e}}))}();e.innerHTML=`\n            <div class="dashboard">\n                <div class="dashboard-header">\n                    <h1>Welcome, ${t}!</h1>\n                    <div class="profile-dropdown">\n                        <button id="profile-dropdown-button" class="profile-dropdown-button">\n                            <img src="/assets/default-avatar.png" alt="profile" id="user-avatar">\n                            <span class="arrow-down"></span>\n                        </button>\n                        <div class="profile-dropdown-content">\n                            <button id="settings-button">Settings</button>\n                            <button id="logout-button">Logout</button>\n                        </div>\n                    </div>\n                </div>\n                <div class="dashboard-content">\n                    <div class="main-content">\n                        <div id="streak-summary">\n                            <h2>Streak Summary</h2>\n                            <p id="longest-streak">Longest Streak: ${s} days</p>\n                            <p id="current-streak">Current Streak: ${d} days</p>\n                        </div>\n                        <div id="streak-container">\n                            <h2>Your Streaks</h2>\n                            <div id="streaks-list"></div>\n                            <h3>Create New Streak</h3>\n                            <form id="create-streak-form">\n                                <input type="text" id="streak-name" placeholder="Streak Name" required>\n                                <button type="submit" class="dashboard-button">Create</button>\n                            </form>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;const c=document.getElementById("streak-container");c?(console.log("Calling renderStreak..."),function(e){i(this,void 0,void 0,(function*(){if(!e)return void console.error("Streak container not found");e.innerHTML='\n        <div id="streaks-list"></div>\n        <h3>Create New Streak</h3>\n        <form id="create-streak-form">\n            <input type="text" id="streak-name" placeholder="Streak Name" required>\n            <button type="submit">Create</button>\n        </form>\n    ';const t=document.getElementById("create-streak-form");null==t||t.addEventListener("submit",(t=>i(this,void 0,void 0,(function*(){t.preventDefault();const n=document.getElementById("streak-name").value;try{yield function(e){return o(this,void 0,void 0,(function*(){try{const t=localStorage.getItem("token");if(!t)throw new Error("No token found");const n=yield fetch(`${r}/api/streaks`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({name:e})});if(!n.ok){const e=yield n.text();throw new Error(`HTTP error! status: ${n.status}, message: ${e}`)}return n.json()}catch(e){throw console.error("Create streak error:",e),e}}))}(n),l(e)}catch(e){const t=a(e);alert(`Failed to create streak: ${t}`)}})))),e.addEventListener("click",(t=>i(this,void 0,void 0,(function*(){if(t.target instanceof HTMLElement){const n=t.target.getAttribute("data-id");if(n)try{t.target.classList.contains("update-streak")?yield function(e){return o(this,void 0,void 0,(function*(){try{const t=localStorage.getItem("token");if(!t)throw new Error("No token found");const n=yield fetch(`${r}/api/streaks/${e}/increase`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!n.ok){const e=yield n.text();throw new Error(`HTTP error! status: ${n.status}, message: ${e}`)}return n.json()}catch(e){throw console.error("Update streak count error:",e),e}}))}(n):t.target.classList.contains("reset-streak")?yield function(e){return o(this,void 0,void 0,(function*(){try{const t=localStorage.getItem("token");if(!t)throw new Error("No token found");const n=yield fetch(`${r}/api/streaks/${e}/reset`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!n.ok){const e=yield n.text();throw new Error(`HTTP error! status: ${n.status}, message: ${e}`)}return n.json()}catch(e){throw console.error("Reset streak error:",e),e}}))}(n):t.target.classList.contains("delete-streak")&&(yield function(e){return o(this,void 0,void 0,(function*(){try{const t=localStorage.getItem("token");if(!t)throw new Error("No token found");const n=yield fetch(`${r}/api/streaks/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(!n.ok){const e=yield n.text();throw new Error(`HTTP error! status: ${n.status}, message: ${e}`)}}catch(e){throw console.error("Delete streak error:",e),e}}))}(n)),l(e)}catch(e){console.error("Streak action error:",e),alert("Failed to perform action on streak")}}})))),l(e)}))}(c)):console.error("Streak container not found in dashboard");const p=e.querySelector("#user-avatar"),h=localStorage.getItem("avatarUrl");p.src=h?`http://localhost:3000/${h}`:n(972).A;const f=e.querySelector("#profile-dropdown-button"),g=e.querySelector(".profile-dropdown-content");null==f||f.addEventListener("click",(()=>{null==g||g.classList.toggle("show")}));const y=e.querySelector("#settings-button");null==y||y.addEventListener("click",(()=>{m("settings")}));const v=e.querySelector("#logout-button");null==v||v.addEventListener("click",(()=>u(this,void 0,void 0,(function*(){try{yield function(){return o(this,void 0,void 0,(function*(){localStorage.removeItem("token"),localStorage.removeItem("username")}))}(),localStorage.removeItem("username"),m("home")}catch(e){console.error("Logout error:",e),alert("Failed to logout. Please try again.")}})))),document.addEventListener("click",(e=>{(null==f?void 0:f.contains(e.target))||null==g||g.classList.remove("show")}))}catch(t){console.error("Error rendering dashboard:",t),e.innerHTML="<p>Error loading dashboard. Please try again later.</p>"}}))},signup:function(e){if(!e)return;e.innerHTML='\n        <h2>Sign Up</h2>\n        <form id="signup-form">\n            <input type="email" id="email" placeholder="Email" required>\n            <input type="username" id="username" placeholder="Username" required>\n            <input type="password" id="password" placeholder="Password" required>\n            <button type="submit">Sign Up</button>\n            <button id="back-btn">Back</button>\n        </form>\n        <p id="message"></p>\n        <p>Already have an account? <a href="#" id="login-link">Login</a></p>\n    ';const t=document.getElementById("signup-form"),n=document.getElementById("login-link"),a=document.getElementById("message"),i=document.getElementById("back-btn");t.addEventListener("submit",(e=>{return n=this,i=void 0,d=function*(){e.preventDefault();const n=document.getElementById("email").value,i=document.getElementById("username").value,s=document.getElementById("password").value;try{const e=yield function(e,t,n){return o(this,void 0,void 0,(function*(){if(!function(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}(e))throw new Error("Invalid email format");if(!function(e){return e.length>=6}(n))throw new Error("Password must be at least 6 characters long");if(!function(e){return/^[a-zA-Z0-9_]{3,30}$/.test(e)}(t))throw new Error("Username must be 3-30 characters long and contain only letters, numbers, and underscores");try{const o=yield fetch(`${r}/api/auth/signup`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,username:t,password:n})}),a=yield o.json();if(!o.ok)throw new Error(a.message||"Signup failed");return{success:!0,message:"Signup successful"}}catch(e){throw console.error("Signup error:",e),e}}))}(n,i,s);e.success?(a&&(a.textContent="Signup successful! Redirecting to login...",a.style.color="green"),t.reset(),setTimeout((()=>{m("login")}),2e3)):a&&(a.textContent="Signup failed. Please try again.",a.style.color="red")}catch(e){console.error("Signup error:",e),a&&(a.textContent=e instanceof Error?e.message:"An error occurred. Please try again.",a.style.color="red")}},new((s=void 0)||(s=Promise))((function(e,t){function o(e){try{a(d.next(e))}catch(e){t(e)}}function r(e){try{a(d.throw(e))}catch(e){t(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof s?n:new s((function(e){e(n)}))).then(o,r)}a((d=d.apply(n,i||[])).next())}));var n,i,s,d})),null==n||n.addEventListener("click",(e=>{e.preventDefault(),m("login")})),i.addEventListener("click",(()=>{m("home")}))},passwordReset:function(e){e.innerHTML='\n        <h2>Reset Password</h2>\n        <form id="password-reset-form">\n            <input type="email" id="email" placeholder="Enter your email" required>\n            <button type="submit">Request Password Reset</button>\n        </form>\n        <p><a href="#" id="back-to-login">Back to Login</a></p>\n    ';const t=document.getElementById("password-reset-form"),n=document.getElementById("back-to-login");t.addEventListener("submit",(e=>{return t=this,n=void 0,i=function*(){e.preventDefault();const t=document.getElementById("email").value;try{yield function(e){return o(this,void 0,void 0,(function*(){const t=yield fetch(`${r}/api/auth/reset-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(!t.ok){const e=yield t.json().catch((()=>({})));throw new Error(e.message||`Failed to request password reset: ${t.statusText}`)}}))}(t),alert("The reset code has been sent to your email."),m("setNewPassword")}catch(e){console.error("Password reset error:",e),e instanceof Error?alert(`Password reset failed: ${e.message}`):alert("An unexpected error occurred. Please try again.")}},new((a=void 0)||(a=Promise))((function(e,o){function r(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(t){var n;t.done?e(t.value):(n=t.value,n instanceof a?n:new a((function(e){e(n)}))).then(r,s)}d((i=i.apply(t,n||[])).next())}));var t,n,a,i})),null==n||n.addEventListener("click",(e=>{e.preventDefault(),m("login")}))},setNewPassword:function(e){e.innerHTML='\n        <h2>Set New Password</h2>\n        <form id="set-new-password-form">\n            <input type="text" id="reset-code" placeholder="Reset Code" required>\n            <input type="password" id="new-password" placeholder="New Password" required>\n            <input type="password" id="confirm-password" placeholder="Confirm New Password" required>\n            <button type="submit">Set New Password</button>\n        </form>\n        <p><a href="#" id="back-to-login">Back to Login</a></p>\n    ';const t=document.getElementById("set-new-password-form"),n=document.getElementById("back-to-login");t.addEventListener("submit",(e=>{return t=this,n=void 0,i=function*(){e.preventDefault();const t=document.getElementById("reset-code").value,n=document.getElementById("new-password").value;if(n===document.getElementById("confirm-password").value)try{yield function(e,t){return o(this,void 0,void 0,(function*(){const n=yield fetch(`${r}/api/auth/reset-password/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:t})});if(!n.ok){const e=yield n.json().catch((()=>({})));throw new Error(e.message||`Failed to reset password: ${n.statusText}`)}}))}(t,n),alert("Password has been updated successfully."),m("login")}catch(e){console.error("Password reset error:",e),e instanceof Error?alert(`Password reset failed: ${e.message}`):alert("An unexpected error occurred. Please try again.")}else alert("Passwords do not match. Please try again.")},new((a=void 0)||(a=Promise))((function(e,o){function r(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(t){var n;t.done?e(t.value):(n=t.value,n instanceof a?n:new a((function(e){e(n)}))).then(r,s)}d((i=i.apply(t,n||[])).next())}));var t,n,a,i})),null==n||n.addEventListener("click",(e=>{e.preventDefault(),m("login")}))},settings:function(e){if(!e)return void console.error("Settings container not found");e.innerHTML='\n        <style>\n            #settings-form {\n                max-width: 600px;\n                margin: 0 auto;\n                padding: 20px;\n            }\n            .settings-row {\n                display: flex;\n                align-items: center;\n                margin-bottom: 15px;\n            }\n            .settings-row label {\n                display: flex;\n                align-items: center;\n                margin-right: 10px;\n                min-width: 150px;\n            }\n            .settings-row input[type="checkbox"] {\n                margin-right: 5px;\n            }\n            .settings-row input[type="text"],\n            .settings-row input[type="email"],\n            .settings-row input[type="password"],\n            .settings-row input[type="file"] {\n                flex: 1;\n                padding: 5px;\n            }\n            .button-container {\n                display: flex;\n                justify-content: space-between;\n                margin-top: 20px;\n            }\n            @media (max-width: 480px) {\n                .settings-row {\n                    flex-direction: column;\n                    align-items: flex-start;\n                }\n                .settings-row label {\n                    margin-bottom: 5px;\n                }\n                .settings-row input[type="text"],\n                .settings-row input[type="email"],\n                .settings-row input[type="password"],\n                .settings-row input[type="file"] {\n                    width: 100%;\n                }\n            }\n        </style>\n        <h1>Settings</h1>\n        <form id="settings-form">\n            <div class="settings-row">\n                <label>\n                    <input type="checkbox" id="change-username" name="change-username">\n                    Update Username\n                </label>\n                <input type="text" id="username" name="username" disabled>\n            </div>\n\n            <div class="settings-row">\n                <label>\n                    <input type="checkbox" id="change-email" name="change-email">\n                    Update Email\n                </label>\n                <input type="email" id="email" name="email" disabled>\n            </div>\n\n            <div class="settings-row">\n                <label>\n                    <input type="checkbox" id="change-password" name="change-password">\n                    Update Password\n                </label>\n                <input type="password" id="password" name="password" disabled>\n            </div>\n\n            <div class="settings-row">\n                <label>\n                    <input type="checkbox" id="change-profile-photo" name="change-profile-photo">\n                    Update Profile Photo\n                </label>\n                <input type="file" id="profile-photo" name="profile-photo" accept="image/*" disabled>\n            </div>\n\n            <div class="button-container">\n                <button type="submit">Save Changes</button>\n                <button type="button" id="back-button">Back</button>\n            </div>\n        </form>\n    ';const t=document.getElementById("settings-form"),n=document.getElementById("change-username"),i=document.getElementById("change-email"),s=document.getElementById("change-password"),d=document.getElementById("change-profile-photo");n.addEventListener("change",(()=>{document.getElementById("username").disabled=!n.checked})),i.addEventListener("change",(()=>{document.getElementById("email").disabled=!i.checked})),s.addEventListener("change",(()=>{document.getElementById("password").disabled=!s.checked})),d.addEventListener("change",(()=>{document.getElementById("profile-photo").disabled=!d.checked})),null==t||t.addEventListener("submit",(e=>{return t=this,n=void 0,s=function*(){var t;e.preventDefault();const n=document.getElementById("username").value,i=document.getElementById("email").value,s=document.getElementById("password").value,d=null===(t=document.getElementById("profile-photo").files)||void 0===t?void 0:t[0];let c=!1;try{if(n||i||s){const e=yield function(e,t,n){return o(this,void 0,void 0,(function*(){const o=localStorage.getItem("token");if(!o)throw new Error("No token found");const a={};if(null!==e&&""!==e&&(a.username=e),null!==t&&""!==t&&(a.email=t),null!==n&&""!==n&&(a.password=n),0===Object.keys(a).length)return!1;const i=yield fetch(`${r}/api/users/profile`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(a)});if(200===i.status){const e=yield i.text();if("OK"===e)return!0;try{if("Verification code sent to new email"===JSON.parse(e).message)return"verification_required"}catch(e){console.error("Error parsing response:",e)}}if(!i.ok){const e=yield i.json().catch((()=>({})));throw"USERNAME_EXISTS"===e.code?new Error("Username already exists"):"EMAIL_EXISTS"===e.code?new Error("Email already exists"):new Error(e.message||`Failed to update profile: ${i.statusText}`)}return!0}))}(n,i,s);if(console.log("Profile update response:",e),c=!0,"verification_required"===e){const e=prompt("Please enter the verification code sent to your new email:");if(!e)throw new Error("Email verification cancelled");yield function(e){return o(this,void 0,void 0,(function*(){const t=localStorage.getItem("token");if(!t)throw new Error("No token found");const n=yield fetch(`${r}/api/users/verify-email`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({verificationCode:e})});if(!n.ok){const e=yield n.json().catch((()=>({})));throw new Error(e.message||`Failed to verify email: ${n.statusText}`)}}))}(e),console.log("Email verified successfully"),alert("Profile updated and email verified successfully")}else console.log("Profile updated successfully"),alert("Profile updated successfully")}d&&(yield function(e){return o(this,void 0,void 0,(function*(){console.log("Uploading profile photo:",e.name);const t=localStorage.getItem("token");if(!t)throw console.error("No token found"),new Error("No token found");const n=new FormData;n.append("photo",e),console.log("Sending photo upload request");const o=yield fetch(`${r}/api/users/profile/photo`,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:n});if(console.log("Photo upload response status:",o.status),!o.ok){const e=yield o.json().catch((()=>({})));throw console.error("Photo upload error:",e),new Error(e.message||`Failed to upload profile photo: ${o.statusText}`)}const a=yield o.json();console.log("Profile photo uploaded successfully",a),a.photoUrl&&localStorage.setItem("avatarUrl",a.photoUrl)}))}(d),console.log("Profile photo uploaded successfully"),c=!0),c?m("dashboard"):alert("No changes were made.")}catch(e){console.error("Error updating profile:",e);const t=a(e);alert(`Failed to update profile: ${t}`)}},new((i=void 0)||(i=Promise))((function(e,o){function r(e){try{d(s.next(e))}catch(e){o(e)}}function a(e){try{d(s.throw(e))}catch(e){o(e)}}function d(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,a)}d((s=s.apply(t,n||[])).next())}));var t,n,i,s}));const c=document.getElementById("back-button");null==c||c.addEventListener("click",(()=>{m("dashboard")}))}};function m(e){const t=document.getElementById("app");t&&e in p?(console.log(`Navigating to route: ${e}`),t.innerHTML="",p[e](t),window.history.pushState(null,"",`#${e}`)):console.error("Invalid route or container not found:",e)}function h(){localStorage.removeItem("token"),localStorage.removeItem("userId"),m("home")}function f(){const e=window.location.hash.slice(1)||"home";console.log(`Current hash: ${e}`),m(e in p?e:"home")}document.addEventListener("DOMContentLoaded",(()=>{window.addEventListener("hashchange",f),f();const e=document.getElementById("logout-button");e?e.addEventListener("click",h):console.error("Logout button not found")})),window.addEventListener("error",(e=>{console.error("Unhandled error:",e.error),alert("An unexpected error occurred. Please try again later.")}))})();